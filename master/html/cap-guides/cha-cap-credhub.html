<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang=""><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Integrating CredHub with SUSE Cloud Application Platform | Deployment, Administration, and User Guides | SUSE Cloud Application Platform 2.1.1</title><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" /><link rel="stylesheet" type="text/css" href="static/css/style.css" /><link rel="stylesheet" type="text/css" href="static/css/highlight.css" /><meta name="generator" content="DAPS 3.2.0 (https://opensuse.github.io/daps) using SUSE XSL Stylesheets 2.81.0 (based on DocBook XSL Stylesheets 1.79.2) - chunked" /><meta name="product-name" content="SUSE Cloud Application Platform" /><meta name="product-number" content="2.1.1" /><meta name="book-title" content="Deployment, Administration, and User Guides" /><meta name="chapter-title" content="Chapter 24. Integrating CredHub with SUSE Cloud Application Platform" /><meta name="description" content="SUSE Cloud Application Platform supports CredHub integration. You should already have a working CredHub instance, a CredHub service on your cluster, then apply the steps in this chapter to connect SUSE Cloud Application Platform." /><meta name="tracker-url" content="https://github.com/SUSE/doc-cap/issues/new" /><meta name="tracker-type" content="gh" /><meta name="tracker-gh-assignee" content="btat" /><meta name="tracker-gh-labels" content="bug,low priority" /><link rel="home" href="index.html" title="SUSE Cloud Application Platform 2.1.1 Documentation" /><link rel="up" href="part-cap-administration.html" title="Part III. SUSE Cloud Application Platform Administration" /><link rel="prev" href="cha-cap-app-autoscaler.html" title="Chapter 23. App-AutoScaler" /><link rel="next" href="cha-cap-buildpacks.html" title="Chapter 25. Buildpacks" />
<script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"></link>');
};

</script><noscript><link rel="stylesheet" type="text/css" href="https://static.opensuse.org/fonts/fonts.css" /></noscript><script src="static/js/jquery-1.10.2.min.js" type="text/javascript"></script><script src="static/js/script.js" type="text/javascript"></script><script src="static/js/highlight.min.js" type="text/javascript"></script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script></head><body class="draft offline js-off" onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="bypass-block"><a href="#_content">Jump to content</a><a href="#_bottom-navigation">Jump to page navigation: previous page [access key p]/next page [access key n]</a></div><div id="_outer-wrap"><div id="_white-bg" style="background-color: #E11;"><div id="_header"><div id="_logo"><img src="static/images/logo.svg" alt="Logo" /></div><div class="crumbs"><a class="book-link" href="index.html" title="SUSE Cloud Application Platform 2.1.1 Documentation"><span class="book-icon">SUSE Cloud Application Platform 2.1.1 Documentation</span></a><span> › </span><a class="crumb" href="book-cap-guides.html">Deployment, Administration, and User Guides</a><span> › </span><a class="crumb" href="part-cap-administration.html">SUSE Cloud Application Platform Administration</a><span> › </span><a class="crumb" href="cha-cap-credhub.html">Integrating CredHub with SUSE Cloud Application Platform</a></div><div class="clearme"></div></div></div><div id="_toolbar-wrap"><div id="_toolbar"><div id="_toc-area" class="inactive"><a id="_toc-area-button" class="tool" title="Contents" accesskey="c" href="index.html"><span class="tool-spacer"><span class="toc-icon">Contents</span><span class="clearme"></span></span><span class="tool-label">Contents</span></a><div class="active-contents bubble-corner"></div><div class="active-contents bubble"><div class="bubble-container"><h6>Deployment, Administration, and User Guides</h6><div id="_bubble-toc"><ol><li class="inactive"><a href="preface-deployment.html"><span class="number"> </span><span class="name">About This Guide</span></a></li><li class="inactive"><a href="part-cap-overview.html"><span class="number">I </span><span class="name">Overview of SUSE Cloud Application Platform</span></a><ol><li class="inactive"><a href="cha-cap-overview.html"><span class="number">1 </span><span class="name">About SUSE Cloud Application Platform</span></a></li><li class="inactive"><a href="cha-cap-depl-kube-requirements.html"><span class="number">2 </span><span class="name">Other Kubernetes Systems</span></a></li></ol></li><li class="inactive"><a href="part-cap-deployment.html"><span class="number">II </span><span class="name">Deploying SUSE Cloud Application Platform</span></a><ol><li class="inactive"><a href="cha-cap-depl-notes.html"><span class="number">3 </span><span class="name">Deployment and Administration Notes</span></a></li><li class="inactive"><a href="cha-cap-depl-caasp.html"><span class="number">4 </span><span class="name">Deploying SUSE Cloud Application Platform on SUSE CaaS Platform</span></a></li><li class="inactive"><a href="cha-cap-depl-aks.html"><span class="number">5 </span><span class="name">Deploying SUSE Cloud Application Platform on Microsoft Azure Kubernetes Service (AKS)</span></a></li><li class="inactive"><a href="cha-cap-depl-eks.html"><span class="number">6 </span><span class="name">Deploying SUSE Cloud Application Platform on Amazon Elastic Kubernetes Service (EKS)</span></a></li><li class="inactive"><a href="cha-cap-depl-gke.html"><span class="number">7 </span><span class="name">Deploying SUSE Cloud Application Platform on Google Kubernetes Engine (GKE)</span></a></li><li class="inactive"><a href="cha-cap-install-stratos.html"><span class="number">8 </span><span class="name">Installing the Stratos Web Console</span></a></li><li class="inactive"><a href="cha-cap-depl-eirini.html"><span class="number">9 </span><span class="name">Eirini</span></a></li><li class="inactive"><a href="cha-cap-depl-terraform.html"><span class="number">10 </span><span class="name">Deploying SUSE Cloud Application Platform Using Terraform</span></a></li><li class="inactive"><a href="cha-cap-depl-air-gap-registry.html"><span class="number">11 </span><span class="name">Setting Up a Registry for an Air Gapped Environment</span></a></li><li class="inactive"><a href="cha-cap-depl-private-registry.html"><span class="number">12 </span><span class="name">SUSE Private Registry</span></a></li></ol></li><li class="inactive"><a href="part-cap-administration.html"><span class="number">III </span><span class="name">SUSE Cloud Application Platform Administration</span></a><ol><li class="inactive"><a href="cha-cap-upgrade.html"><span class="number">13 </span><span class="name">Upgrading SUSE Cloud Application Platform</span></a></li><li class="inactive"><a href="cha-cap-configuration-changes.html"><span class="number">14 </span><span class="name">Configuration Changes</span></a></li><li class="inactive"><a href="cha-cap-create-admin-user.html"><span class="number">15 </span><span class="name">Creating Admin Users</span></a></li><li class="inactive"><a href="cha-cap-manage-passwords.html"><span class="number">16 </span><span class="name">Managing Passwords</span></a></li><li class="inactive"><a href="cha-cap-uaa-ui.html"><span class="number">17 </span><span class="name">Accessing the UAA User Interface</span></a></li><li class="inactive"><a href="cha-cap-memory-limits.html"><span class="number">18 </span><span class="name">Container Memory Limits and Requests</span></a></li><li class="inactive"><a href="cha-cap-ccdb-secret-rotation.html"><span class="number">19 </span><span class="name">Cloud Controller Database Secret Rotation</span></a></li><li class="inactive"><a href="cha-cap-secrets-rotation.html"><span class="number">20 </span><span class="name">Rotating Automatically Generated Secrets</span></a></li><li class="inactive"><a href="cha-cap-backup-restore.html"><span class="number">21 </span><span class="name">Backup and Restore</span></a></li><li class="inactive"><a href="cha-cap-service-brokers.html"><span class="number">22 </span><span class="name">Service Brokers</span></a></li><li class="inactive"><a href="cha-cap-app-autoscaler.html"><span class="number">23 </span><span class="name">App-AutoScaler</span></a></li><li class="inactive"><a href="cha-cap-credhub.html"><span class="number">24 </span><span class="name">Integrating CredHub with SUSE Cloud Application Platform</span></a></li><li class="inactive"><a href="cha-cap-buildpacks.html"><span class="number">25 </span><span class="name">Buildpacks</span></a></li></ol></li><li class="inactive"><a href="part-cap-user-guide.html"><span class="number">IV </span><span class="name">SUSE Cloud Application Platform User Guide</span></a><ol><li class="inactive"><a href="cha-cap-cf-cli.html"><span class="number">26 </span><span class="name">Deploying and Managing Applications with the Cloud Foundry Client</span></a></li></ol></li><li class="inactive"><a href="part-cap-troubleshooting.html"><span class="number">V </span><span class="name">Troubleshooting</span></a><ol><li class="inactive"><a href="cha-cap-depl-troubleshooting.html"><span class="number">27 </span><span class="name">Troubleshooting</span></a></li></ol></li><li class="inactive"><a href="bk01apa.html"><span class="number">A </span><span class="name">Appendix</span></a></li><li class="inactive"><a href="bk01apb.html"><span class="number">B </span><span class="name">GNU Licenses</span></a></li></ol></div><div class="clearme"></div></div></div></div><div id="_nav-area" class="inactive"><div class="tool"><span class="nav-inner"><span class="tool-label">Navigation</span><a accesskey="p" class="tool-spacer" title="Chapter 23. App-AutoScaler" href="cha-cap-app-autoscaler.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 25. Buildpacks" href="cha-cap-buildpacks.html"><span class="next-icon">→</span></a></span></div></div></div></div><div id="_fixed-header-wrap" style="background-color: #E11;" class="inactive"><div id="_fixed-header"><div class="crumbs"><a class="book-link" href="index.html" title="SUSE Cloud Application Platform 2.1.1 Documentation"><span class="book-icon">SUSE Cloud Application Platform 2.1.1 Documentation</span></a><span> › </span><a class="crumb" href="book-cap-guides.html">Deployment, Administration, and User Guides</a><span> › </span><a class="crumb" href="part-cap-administration.html">SUSE Cloud Application Platform Administration</a><span> › </span><a class="crumb" href="cha-cap-credhub.html">Integrating CredHub with SUSE Cloud Application Platform</a></div><div class="buttons"><a class="top-button button" href="#">Top</a><div class="button"><a accesskey="p" class="tool-spacer" title="Chapter 23. App-AutoScaler" href="cha-cap-app-autoscaler.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 25. Buildpacks" href="cha-cap-buildpacks.html"><span class="next-icon">→</span></a></div><div class="clearme"></div></div><div class="clearme"></div></div></div><div id="_content" class="draft "><div class="documentation"><div class="chapter " id="cha-cap-credhub"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname ">SUSE Cloud Application Platform</span> <span class="productnumber ">2.1.1</span></div><div><h2 class="title"><span class="number">24 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Integrating CredHub with SUSE Cloud Application Platform</span> <a title="Permalink" class="permalink" href="cha-cap-credhub.html#">#</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>cap_admin_credhub.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="sect1"><a href="cha-cap-credhub.html#sec-cap-credhub"><span class="number">24.1 </span><span class="name">Installing the CredHub Client</span></a></span></dt><dt><span class="sect1"><a href="cha-cap-credhub.html#sec-cap-credhub-enable"><span class="number">24.2 </span><span class="name">Enabling and Disabling CredHub</span></a></span></dt><dt><span class="sect1"><a href="cha-cap-credhub.html#sec-cap-credhub-connect"><span class="number">24.3 </span><span class="name">Connecting to the CredHub Service</span></a></span></dt></dl></div></div><p>
  SUSE Cloud Application Platform supports CredHub integration. You should already have a working
  CredHub instance, a CredHub service on your cluster, then apply the steps in
  this chapter to connect SUSE Cloud Application Platform.
 </p><div class="sect1 " id="sec-cap-credhub"><div class="titlepage"><div><div><h2 class="title"><span class="number">24.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Installing the CredHub Client</span> <a title="Permalink" class="permalink" href="cha-cap-credhub.html#sec-cap-credhub">#</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>cap_admin_credhub.xml</li><li><span class="ds-label">ID: </span>sec-cap-credhub</li></ul></div></div></div></div><p>
   Start by creating a new directory for the CredHub client on your local
   workstation, then download and unpack the CredHub client. The following
   example is for the 2.2.0 Linux release. For other platforms and current
   releases, see the cloudfoundry-incubator/credhub-cli at
   <a class="link" href="https://github.com/cloudfoundry-incubator/credhub-cli/releases" target="_blank">https://github.com/cloudfoundry-incubator/credhub-cli/releases</a>
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code>mkdir <em class="replaceable ">chclient</em>
<code class="prompt user">tux &gt; </code>cd <em class="replaceable ">chclient</em>
<code class="prompt user">tux &gt; </code>wget https://github.com/cloudfoundry-incubator/credhub-cli/releases/download/2.2.0/credhub-linux-2.2.0.tgz
<code class="prompt user">tux &gt; </code>tar zxf credhub-linux-2.2.0.tgz</pre></div></div><div class="sect1 " id="sec-cap-credhub-enable"><div class="titlepage"><div><div><h2 class="title"><span class="number">24.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Enabling and Disabling CredHub</span> <a title="Permalink" class="permalink" href="cha-cap-credhub.html#sec-cap-credhub-enable">#</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>cap_admin_credhub.xml</li><li><span class="ds-label">ID: </span>sec-cap-credhub-enable</li></ul></div></div></div></div><p>
   CredHub is enabled by default. To disable it, add the following the following
   block to your <code class="filename">kubecf-config-values.yaml</code> file.
  </p><div class="verbatim-wrap"><pre class="screen">features:
  credhub:
    enabled: false</pre></div><p>
   To enable CredHub again, update the above block in your <code class="filename">kubecf-config-values.yaml</code> so that
   <code class="literal">enabled</code> is set to <code class="literal">true</code>.
  </p><p>
  After making the change above, and any other configuration changes, apply the
   update by doing the following:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     For an initial deployment, continue to the deployment steps for your platform:
    </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
       For SUSE CaaS Platform, see <a class="xref" href="cha-cap-depl-caasp.html#sec-cap-cap-on-caasp" title="4.13. Deploying SUSE Cloud Application Platform">Section 4.13, “Deploying SUSE Cloud Application Platform”</a>.
      </p></li><li class="listitem "><p>
       For Microsoft AKS, see <a class="xref" href="cha-cap-depl-aks.html#sec-cap-cap-on-aks" title="5.13. Deploying SUSE Cloud Application Platform">Section 5.13, “Deploying SUSE Cloud Application Platform”</a>.
      </p></li><li class="listitem "><p>
       For Amazon EKS, see <a class="xref" href="cha-cap-depl-eks.html#sec-cap-cap-on-eks" title="6.13. Deploying SUSE Cloud Application Platform">Section 6.13, “Deploying SUSE Cloud Application Platform”</a>.
      </p></li><li class="listitem "><p>
       For Google GKE, see <a class="xref" href="cha-cap-depl-gke.html#sec-cap-cap-on-gke" title="7.14. Deploying SUSE Cloud Application Platform">Section 7.14, “Deploying SUSE Cloud Application Platform”</a>.
      </p></li></ul></div></li><li class="listitem "><p>
     For an existing deployment, use <code class="command">helm upgrade</code> to apply
     the change.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code>helm upgrade <em class="replaceable ">kubecf</em> suse/kubecf \
--namespace <em class="replaceable ">kubecf</em> \
--values <em class="replaceable ">kubecf-config-values.yaml</em> \
--version 2.7.13</pre></div></li></ul></div><div id="id-1.3.5.14.4.7" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg" /><h6>Warning</h6><p>
    On occasion, the <code class="literal">credhub</code> pod may fail to start due to
    database migration failures; this has been spotted intermittently on
    Microsoft Azure Kubernetes Service and to a lesser extent, other public clouds.
    In these situations, manual intervention is required to track the last
    completed transaction in <code class="literal">credhub_user</code> database and
    update the flyway schema history table with the record of the last
    completed transaction. Please contact support for further instructions.
   </p></div></div><div class="sect1 " id="sec-cap-credhub-connect"><div class="titlepage"><div><div><h2 class="title"><span class="number">24.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Connecting to the CredHub Service</span> <a title="Permalink" class="permalink" href="cha-cap-credhub.html#sec-cap-credhub-connect">#</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>cap_admin_credhub.xml</li><li><span class="ds-label">ID: </span>sec-cap-credhub-connect</li></ul></div></div></div></div><p>
   Set environment variables for the CredHub client, your CredHub service
   location, and Cloud Application Platform namespace. In these guides the example namespace is
   <code class="literal">kubecf</code>:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code>CH_CLI=~/chclient/credhub
<code class="prompt user">tux &gt; </code>CH_SERVICE=<em class="replaceable ">https://credhub.example.com</em>
<code class="prompt user">tux &gt; </code>NAMESPACE=<em class="replaceable ">kubecf</em></pre></div><p>
   Set up the CredHub service location:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code>SECRET="$(kubectl get secrets --namespace "${NAMESPACE}" | awk '/^secrets-/ { print $1 }')"
<code class="prompt user">tux &gt; </code>CH_SECRET="$(kubectl get secrets --namespace "${NAMESPACE}" "${SECRET}" --output jsonpath="{.data['uaa-clients-credhub-user-cli-secret']}"|base64 --decode)"
<code class="prompt user">tux &gt; </code>CH_CLIENT=credhub_user_cli
<code class="prompt user">tux &gt; </code>echo Service ......@ $CH_SERVICE
<code class="prompt user">tux &gt; </code>echo CH cli Secret @ $CH_SECRET</pre></div><p>
   Set the CredHub target through its Kubernetes service, then log into CredHub:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code>"${CH_CLI}" api --skip-tls-validation --server "${CH_SERVICE}"
<code class="prompt user">tux &gt; </code>"${CH_CLI}" login --client-name="${CH_CLIENT}" --client-secret="${CH_SECRET}"</pre></div><p>
   Test your new connection by inserting and retrieving some fake credentials:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code>"${CH_CLI}" set --name FOX --type value --value 'fox over lazy dog'
<code class="prompt user">tux &gt; </code>"${CH_CLI}" set --name DOG --type user --username dog --password fox
<code class="prompt user">tux &gt; </code>"${CH_CLI}" get --name FOX
<code class="prompt user">tux &gt; </code>"${CH_CLI}" get --name DOG</pre></div></div></div></div><div class="page-bottom"><div id="_bottom-navigation"><a class="nav-link" href="cha-cap-buildpacks.html"><span class="next-icon">→</span><span class="nav-label"><span class="number">Chapter 25 </span>Buildpacks</span></a><a class="nav-link" href="cha-cap-app-autoscaler.html"><span class="prev-icon">←</span><span class="nav-label"><span class="number">Chapter 23 </span>App-AutoScaler</span></a></div><div class="_share-print"><div class="online-contents share"><strong>Share this page: </strong><span class="share-buttons"><span class="_share-fb bottom-button">Facebook</span><span class="spacer"> • </span><span class="_share-in bottom-button">LinkedIn</span><span class="spacer"> • </span><span class="_share-tw bottom-button">Twitter</span><span class="spacer"> • </span><span class="_share-mail bottom-button">E-Mail</span></span></div><div class="print"><span class="_print-button bottom-button">Print this page</span></div><div class="clearme"></div></div></div></div><div id="_inward"></div></div><div id="_footer-wrap"><div id="_footer"><p>©
        2021 
        SUSE</p><ul><li><a href="https://jobs.suse.com/" target="_top">Careers</a></li><li><a href="https://www.suse.com/company/legal/" target="_top">Legal</a></li><li><a href="https://www.suse.com/company/about/" target="_top">About</a></li><li><a href="https://www.suse.com/contact/" target="_top">Contact Us</a></li></ul></div></div></body></html>